{% extends 'TreeFinder/base.html' %}

{% block content %}

<head>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
</head>
<body>
<input id="searchTextField" type="text" size="50">
</body>
<!-- TUTORIAL CODE: MODIFIED-->
    <div id='map_canvas' style='width:100%;height:400px;'></div>
  <script type="text/javascript">

      var geocoder = new google.maps.Geocoder();
      var homeAddress = "Vancouver, Canada";
      var map;

      var myOptions = {
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          mapTypeControl: false
      };

    geocoder.geocode( { 'address': homeAddress}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        var latitude = results[0].geometry.location.lat();
        var longitude = results[0].geometry.location.lng();
        myOptions.center = new google.maps.LatLng(latitude,longitude);

          map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
      }
    });

    function initialize(latitude,longitude) {
        var defaultBounds = new google.maps.LatLngBounds(
                new google.maps.LatLng(40.802089, -124.163751)
        );
        var options = {
            bounds: defaultBounds,
        };

        var latlng = new google.maps.LatLng(latitude, longitude);
        var marker = new google.maps.Marker({
            position: latlng,
            map: map,
            title: "its a tree"
        });
        var input = document.getElementById('searchTextField');
        var autocomplete = new google.maps.places.Autocomplete(input, options);

    }
      google.maps.event.addDomListener(window, 'load', initialize);

      var treesListJson = '{{ Trees|safe }}';
      var aFewTrees = JSON.parse(treesListJson);

  for (i=0; i<aFewTrees.length; i++) {
      var tree = aFewTrees[i].fields;
      var treeAddress = tree.civicNumber.toString() + " " + tree.onStreet.toString() + ", Vancouver, Canada";
      console.log(treeAddress);
      geocoder.geocode( { 'address': treeAddress}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            var latitude = results[0].geometry.location.lat();
            var longitude = results[0].geometry.location.lng();

            initialize(latitude,longitude);
      }
    });
  }
</script>

      <form id="filter_form" method="post" action="/filter/">

    {% csrf_token %}
            {% for field in form.visible_fields %}
                {{ field.errors }}
                {{ field.help_text }}
                {{ field }}
            {% endfor %}

            <input type="submit" name="submit" value="Find Trees" />
        </form>

{% endblock %}
